# Редактирование позиций
Пользователь может отправить данные в ЕГАИС для одного дня ЖУПа несколько раз. 
Каждый раз перед отправкой мы смотрим на диф и отправляем акты только по тому количеству продукции, 
которое еще не было списано. Если диф отрицательный, мы делаем акт постановки, если диф положительный – акт списания. 
Ниже описан новый порядок работы с дифом с учетом того, что есть сумма продажи и марки.

## Редактирование ручных пивных позиций
Не меняем, пользователь может:
1. изменять количество: пересчитываем сумму продажи;
2. изменять цену за единицу: пересчитываем сумму продажи;
3. удалять позиции до и после отправки.

## Редактирование ручных позиций крепкого алкоголя с марками
Пользователь может:
1. добавлять количество сканированием марки: пересчитываем сумму продажи;
2. изменять цену за единицу: пересчитываем сумму продажи.

### Удаление ручных позиций крепкого алкоголя с марками
Даем пользователю инструмент по удалению марок из журнала учета продаж, который позволяет:
1. посмотреть уже отсканированные в строке марки -- нет мотивации, что это действительно нужно;
2. убрать произвольную марку из строки, если эта марка еще не была отправлена в ЕГАИС, используем сканирование;
3. удалить строку с марками целиком, если в строке нет ни одной отправленной марки;

### Как это работает
По действию пользователя (нажал на корзину в строке с нужной позицией) проверяем наличие марок в актах, привязанных к этому дню журнала,  за исключением актов в состоянии ```EgaisRejected``` в архиве.
Если ни одной марки из строки нет в отправленных, даем удалить всю строку с марками:
1. предупреждаем, что удалим все;
2. *рассказываем, как можно удалить только 1 марку*.

Если хотя бы одна марка в строке есть в отправленном акте в ЕГАИС (в том числе с незавершенным ДО),
показываем тултип и рассказываем, что позицию с отправленными марками удалить нельзя. Рассказываем, как удалить 1 марку из строки.
Если юзер нажимает на "Количество" в строке, он может отсканировать марку, которую хочет удалить из строки.
Валидации:

- марка есть в строке;
- марка еще не была отправлена.

Если марка есть в строке:
1. И она еще не была отправлена: удаляем ее из строки, уменьшаем количество на 1;
2. И она была отправлена: не удаляем марку из строки, рассказываем, что делать.

Если марки нет в строке, предлагаем ее добавить, рассказываем, что делать, если это возврат.

### Остальные валидации
* AlcCode из марки не соответвует продукции в строке;
* В локальном каталоге нет накого AlcCode;
* В глобальном каталоге нет такого AlcCode;
* Длина марки д.б. 68 символов;
* Марка долна состоять из цифр и латинских букв;
* Что-то пошло не так при сканировании. 
